<!DOCTYPE html>
<html lang="cs" style="scroll-behavior: smooth;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Zjistěte předem, jakou výši hypotéky si můžete dovolit. Hypoteční prescoring kalkulačka pro lepší finanční plánování.">
    <meta name="keywords" content="hypotéka, hypoteční poradenství, úvěr na bydlení, refinancování, hypoteční kalkulačka, úroková sazba">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Hypoteeka.cz">
    
    <!-- Canonical link -->
    <link rel="canonical" href="https://www.hypoteeka.cz/kalkulacka-prescoring.html">
    
    <!-- Open Graph meta tags -->
    <meta property="og:title" content="Prescoring kalkulačka | Hypoteeka.cz">
    <meta property="og:description" content="Zjistěte předem, jakou výši hypotéky si můžete dovolit. Hypoteční prescoring kalkulačka pro lepší finanční plánování.">
    <meta property="og:image" content="https://www.hypoteeka.cz/images/og-image.jpg">
    <meta property="og:url" content="https://www.hypoteeka.cz/kalkulacka-prescoring.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Hypoteeka.cz">
    
    <!-- Twitter Card meta tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Prescoring kalkulačka | Hypoteeka.cz">
    <meta name="twitter:description" content="Zjistěte předem, jakou výši hypotéky si můžete dovolit. Hypoteční prescoring kalkulačka pro lepší finanční plánování.">
    <meta name="twitter:image" content="https://www.hypoteeka.cz/images/og-image.jpg">
    <title>Prescoring kalkulačka | Hypoteeka.cz</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .nav-link {
            @apply text-base font-medium transition-colors duration-200;
        }
        .btn {
            @apply inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200;
        }
        .btn-primary {
            @apply bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500;
        }
        .btn-secondary {
            @apply bg-white text-primary-600 border-primary-600 hover:bg-primary-50 focus:ring-primary-500;
        }
        .btn-icon {
            @apply p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500;
        }
        [x-cloak] { display: none !important; }

        /* Primary colors - Dark Blue */
        .bg-primary-500 { background-color: #0F4C81; }
        .bg-primary-600 { background-color: #0D3D66; }
        .bg-primary-700 { background-color: #0B2F4D; }
        .text-primary-500 { color: #0F4C81; }
        .text-primary-600 { color: #0D3D66; }
        .text-primary-100 { color: #E6F3FF; }
        
        /* Gradients */
        .bg-gradient-to-br {
            background-image: linear-gradient(to bottom right, var(--tw-gradient-stops));
        }
        .from-primary-600 {
            --tw-gradient-from: #0D3D66;
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgb(67 56 202 / 0));
        }
        .to-primary-700 {
            --tw-gradient-to: #0B2F4D;
        }
        
        /* Opacity */
        .bg-primary-500\/20 {
            background-color: rgb(15 76 129 / 0.2);
        }
        
        /* Backdrop blur */
        .backdrop-blur-sm {
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }
        
        /* Další styly */
        .bg-primary-50 { background-color: #F0F7FF; }
        .border-primary-100 { border-color: #E6F3FF; }
    </style>
</head>
<body class="bg-white">
<div id="nav-container"></div>
    <div x-data="{ mobileMenuOpen: false }">
        <!-- Nav include -->
        

        <main>
            <!-- Hero sekce -->
            <div class="relative min-h-[800px] flex items-center pb-96">
                <div class="absolute inset-0 z-0">
                    <img src="images/hero.png" alt="" class="w-full h-full object-cover">
                    <div class="absolute inset-0 backdrop-blur-sm bg-black/20"></div>
                </div>
            </div>
    
            <!-- Kalkulačka -->
            <div class="mx-auto max-w-7xl px-6 lg:px-8 -mt-32 relative z-20">
                <div class="mx-auto max-w-4xl bg-white rounded-3xl shadow-xl p-8">
                    <div class="text-center mb-16">
                        <h2 class="text-base font-semibold leading-7 text-primary-600">PRESCORING</h2>
                        <p class="mt-2 text-4xl font-bold tracking-tight text-gray-900 sm:text-5xl">Zjistěte svou šanci na hypotéku</p>
                        <p class="mt-6 text-lg leading-8 text-gray-600">Vypočítejte si předběžné posouzení vaší schopnosti splácet hypotéku</p>
                    </div>
    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Vstupní údaje -->
                        <div class="overflow-hidden bg-gray-50 rounded-2xl p-8 shadow-lg border border-gray-100">
                            <h2 class="text-2xl font-bold text-gray-900 mb-8">Vaše údaje</h2>
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-base font-medium text-gray-900 mb-3">Jaký je váš čistý měsíční příjem?</label>
                                    <div class="relative mt-2">
                                        <input type="text" id="monthly-income" class="block w-full rounded-xl border-0 py-5 px-6 pr-16 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 text-lg font-medium" value="50 000">
                                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <span class="text-gray-500">Kč</span>
                                        </div>
                                    </div>
                                    <p class="mt-2 text-sm text-gray-600">Váš čistý měsíční příjem je základem pro výpočet vaší schopnosti splácet hypotéku (DSTI).</p>
                                </div>
    
                                <div>
                                    <label class="block text-base font-medium text-gray-900 mb-3">Jaké jsou vaše měsíční výdaje?</label>
                                    <div class="relative mt-2">
                                        <input type="text" id="monthly-expenses" class="block w-full rounded-xl border-0 py-5 px-6 pr-16 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 text-lg font-medium" value="10 000">
                                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <span class="text-gray-500">Kč</span>
                                        </div>
                                    </div>
                                    <p class="mt-2 text-sm text-gray-600">Běžné výdaje jako nájem, jídlo, dopravu, zájmy atd.</p>
                                </div>

                                <div>
                                    <label class="block text-base font-medium text-gray-900 mb-3">Jaké máte stávající závazky?</label>
                                    <div class="relative mt-2">
                                        <input type="text" id="monthly-debts" class="block w-full rounded-xl border-0 py-5 px-6 pr-16 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 text-lg font-medium" value="0">
                                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <span class="text-gray-500">Kč</span>
                                        </div>
                                    </div>
                                    <p class="mt-2 text-sm text-gray-600">Měsíční splátky úvěrů, půjček, leasingu, kontokorentu atd.</p>
                                </div>
    
                                <div>
                                    <label class="block text-base font-medium text-gray-900 mb-3">Kolik máte vyživovaných osob?</label>
                                    <div class="relative mt-2">
                                        <select id="dependents" class="block w-full rounded-xl border-0 py-5 px-6 pr-16 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 text-lg font-medium">
                                        <option value="0">0</option>
                                        <option value="1">1</option>
                                        <option value="2" selected>2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5+</option>
                                        </select>
                                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <svg class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
    
                                <div>
                                    <label class="block text-base font-medium text-gray-900 mb-3">Jaká je hodnota nemovitosti?</label>
                                    <div class="relative mt-2">
                                        <input type="text" id="property-value" class="block w-full rounded-xl border-0 py-5 px-6 pr-16 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 text-lg font-medium" value="0">
                                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <span class="text-gray-500">Kč</span>
                                        </div>
                                    </div>
                                    <p class="mt-2 text-sm text-gray-600">Hodnota nemovitosti je důležitá pro výpočet LTV (poměr úvěru k hodnotě nemovitosti).</p>
                                </div>
    
                                <div>
                                    <label class="block text-base font-medium text-gray-900 mb-3">Na jak dlouho chcete hypotéku?</label>
                                    <div class="relative mt-2">
                                        <select id="mortgage-years" class="block w-full rounded-xl border-0 py-5 px-6 pr-16 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 text-lg font-medium">
                                        <option value="20">20 let</option>
                                        <option value="25">25 let</option>
                                        <option value="30" selected>30 let</option>
                                        <option value="35">35 let</option>
                                        </select>
                                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <svg class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
    
                        <!-- Výsledky -->
                        <div class="overflow-hidden bg-primary-50 rounded-2xl p-8 shadow-lg border border-primary-100">
                            <h2 class="text-2xl font-bold text-gray-900 mb-8">Váš výsledek prescoringu</h2>
                            <p class="text-gray-600 mb-8">Na základě vašich údajů jsme vypočítali následující hodnoty. Banka při posuzování žádosti o hypotéku sleduje zejména ukazatele DSTI (poměr splátky k příjmu) a LTV (poměr úvěru k hodnotě nemovitosti).</p>
                            <div class="space-y-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Maximální výše hypotéky</h3>
                                    <div class="text-3xl font-bold text-primary-600 mb-4" id="max-mortgage">0 Kč</div>
                                </div>
    
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Měsíční splátka</h3>
                                    <div class="text-3xl font-bold text-primary-600 mb-4" id="monthly-payment">0 Kč</div>
                                </div>
    
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4">LTV (Loan to Value)</h3>
                                    <div class="text-3xl font-bold text-primary-600 mb-4" id="ltv">0 %</div>
                                </div>
    
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4">DSTI (Debt Service to Income)</h3>
                                    <div class="text-3xl font-bold text-primary-600 mb-4" id="dsti">0 %</div>
                                </div>

                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4">DTI (Debt To Income)</h3>
                                    <div class="text-3xl font-bold text-primary-600 mb-4" id="dti">0</div>
                                    <p class="text-sm text-gray-600">Váš DTI ukazatel (násobek ročního příjmu). Čím nižší hodnota, tím lépe. Maximální limit je 8.5.</p>
                                </div>

                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Nutné vlastní zdroje</h3>
                                    <div class="text-3xl font-bold text-primary-600 mb-4" id="own-resources">0 Kč</div>
                                    <p class="text-sm text-gray-600">Toto je částka, kterou musíte mít našetřenou z vlastních zdrojů.</p>
                                </div>
    
                                <div class="mt-8 space-y-4">
                                    <div>
                                        <label class="block text-base font-medium text-gray-900 mb-3">Chcete zaslat podrobný report?</label>
                                        <div class="relative mt-2">
                                            <input type="email" id="email" placeholder="vas@email.cz" class="block w-full rounded-xl border-0 py-5 px-6 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 text-lg font-medium">
                                        </div>
                                        <p class="mt-2 text-sm text-gray-600">Pošleme vám podrobný report s vysvětlením všech ukazatelů.</p>
                                    </div>

                                    <button onclick="sendReport()" class="block w-full rounded-full bg-primary-600 px-8 py-4 text-lg font-semibold text-white text-center shadow-lg hover:bg-primary-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600 transition-all duration-200 ease-in-out transform hover:scale-[1.02]">
                                        POSLAT REPORT NA EMAIL
                                    </button>

                                    <a href="index.html#hypoteka" class="block w-full rounded-full bg-primary-600 px-8 py-4 text-lg font-semibold text-white text-center shadow-lg hover:bg-primary-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600 transition-all duration-200 ease-in-out transform hover:scale-[1.02]">
                                        SPOČÍTAT HYPOTÉKU NA MÍRU
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    
        <script>
            // Globální parametry
            const DEFAULT_INTEREST_RATE = 6; // % p.a., lze později parametrizovat / načítat z UI
            // Formátování čísla s mezerami a měnou
            function formatCurrency(number) {
                return new Intl.NumberFormat('cs-CZ').format(Math.round(number)) + ' Kč';
            }
    
            // Formátování procent
            function formatPercent(number) {
                return new Intl.NumberFormat('cs-CZ', { maximumFractionDigits: 1 }).format(number) + ' %';
            }
    
            // Výpočet měsíční splátky
            function calculateMonthlyPayment(loanAmount, years, rate) {
                const monthlyRate = rate / 12 / 100;
                const months = years * 12;
                return (loanAmount * monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);
            }
    
            // Výpočet maximální výše hypotéky (kombinace DSTI a DTI limitu)
            // NOVĚ: Zohledňujeme i měsíční běžné výdaje a používáme měkčí limit DSTI nad disponibilním příjmem
            function calculateMaxMortgage(monthlyIncome, monthlyExpenses, monthlyDebtService, dependents) {
                console.log('===== VÝPOČET HYPOTÉKY =====');
                console.log('Příjem:', monthlyIncome, typeof monthlyIncome);
                console.log('Běžné výdaje:', monthlyExpenses, typeof monthlyExpenses);
                console.log('Dluhové splátky:', monthlyDebtService, typeof monthlyDebtService);
                console.log('Vyživované osoby:', dependents, typeof dependents);

                // 1. Konverze vstupu na čísla
                const income = parseFloat(monthlyIncome);
                const expenses = parseFloat(monthlyExpenses);
                const debts = parseFloat(monthlyDebtService);
                
                // 2. Měkčí DSTI na disponibilní příjem (příjem po odečtení běžných výdajů)
                // Bankovní metodiky typicky pracují s ~45 % příjmu. Zde zvolíme měkčí posouzení 80 % z disponibilního příjmu.
                const dstiLimit = 0.80; // 80 %
                const disposableIncome = Math.max(0, (isNaN(income) ? 0 : income) - (isNaN(expenses) ? 0 : expenses));
                const allowedDebtService = disposableIncome * dstiLimit;
                // Dostupná splátka pro novou hypotéku po odečtení existujících dluhů
                const availableMonthlyPayment = Math.max(0, allowedDebtService - (isNaN(debts) ? 0 : debts));
                console.log('Povolená obsluha dluhu (DSTI ' + (dstiLimit*100) + '% z disponibilního příjmu):', allowedDebtService, 'Kč');
                console.log('Dostupná splátka pro novou hypotéku po odečtení dluhů:', availableMonthlyPayment, 'Kč');
                
                // 3. Získání parametrů hypotéky
                const years = parseInt(document.getElementById('mortgage-years').value);
                const interestRate = DEFAULT_INTEREST_RATE; // % p.a.
                const monthlyRate = interestRate / 12 / 100;
                const months = years * 12;
                
                // 4. Výpočet maximální výše hypotéky podle DSTI
                // Vzorec pro výpočet hypotéky z měsíční splátky
                const maxMortgageDSTI = availableMonthlyPayment > 0
                    ? (availableMonthlyPayment * (Math.pow(1 + monthlyRate, months) - 1)) / (monthlyRate * Math.pow(1 + monthlyRate, months))
                    : 0;
                console.log('Max. hypotéka dle DSTI:', formatCurrency(maxMortgageDSTI));
                
                // 5. Výpočet maximální výše hypotéky podle DTI (Debt-to-Income)
                // Zachováváme konzervativní strop 8.5× roční příjem.
                const dtiMultiplier = 8.5;
                const maxMortgageDTI = income * 12 * dtiMultiplier;
                console.log('Max. hypotéka dle DTI:', formatCurrency(maxMortgageDTI));
                
                // 6. Výsledek je nižší z obou limitů
                const result = Math.min(maxMortgageDSTI, maxMortgageDTI);
                console.log('Výsledná max. hypotéka:', formatCurrency(result));
                
                return result;
            }
    
            // Výpočet celkového Prescoringu podle vzorce
            function calculatePrescoring(ltv, dti, dsti, kreditniHistorie, stabilitaPrijmu) {
                console.log('VSTUPNÍ HODNOTY PRESCORINGU:');
                console.log('- LTV:', ltv, '%, typ:', typeof ltv);
                console.log('- DTI:', dti, 'násobek, typ:', typeof dti);
                console.log('- DSTI:', dsti, '%, typ:', typeof dsti);
                console.log('- Kreditní historie:', kreditniHistorie, 'typ:', typeof kreditniHistorie);
                console.log('- Stabilita příjmu:', stabilitaPrijmu, 'typ:', typeof stabilitaPrijmu);
                
                // Definice maximálních hodnot
                const dtiMax = 8.5; // sjednoceno s limitem v calculateMaxMortgage
                const dstiMax = 0.45; // 45 % (pro <36 let lze později zvýšit na 0.50)
                
                // Váhy jednotlivých složek
                const w1 = 0.2;  // LTV
                const w2 = 0.3;  // DTI
                const w3 = 0.25; // DSTI
                const w4 = 0.15; // Kreditní historie
                const w5 = 0.1;  // Stabilita příjmu

                // Normalizace vstupu – clamp na očekávané rozsahy
                const ltvNorm = Math.max(0, Math.min(100, isNaN(ltv) ? 0 : ltv));
                const dtiNorm = Math.max(0, Math.min(dtiMax, isNaN(dti) ? 0 : dti));
                // dsti očekáváme v rozsahu 0–1 (v updateCalculations se předává dsti/100)
                const dstiInput = isNaN(dsti) ? 0 : (dsti > 1 ? dsti / 100 : dsti);
                const dstiNorm = Math.max(0, Math.min(dstiMax, dstiInput));
                
                // Výpočet jednotlivých částí vzorce
                const ltvScore = w1 * (1 - ltvNorm / 100);
                const dtiScore = w2 * (1 - dtiNorm / dtiMax);
                const dstiScore = w3 * (1 - dstiNorm / dstiMax);
                const kreditniHistorieScore = w4 * kreditniHistorie;
                const stabilitaPrijmuScore = w5 * stabilitaPrijmu;
                
                console.log('Prescoring detaily po normalizaci:');
                console.log('- LTV score:', ltvScore.toFixed(3), '(LTV norm:', ltvNorm.toFixed(1) + '%)');
                console.log('- DTI score:', dtiScore.toFixed(3), '(DTI norm:', dtiNorm.toFixed(2) + ', max:', dtiMax + ')');
                console.log('- DSTI score:', dstiScore.toFixed(3), '(DSTI norm:', (dstiNorm*100).toFixed(1) + '%, max:', (dstiMax*100).toFixed(1) + '%)');
                console.log('- Kreditní historie score:', kreditniHistorieScore.toFixed(3));
                console.log('- Stabilita příjmu score:', stabilitaPrijmuScore.toFixed(3));
                
                // Celkový výpočet
                const prescoring = 100 * (ltvScore + dtiScore + dstiScore + kreditniHistorieScore + stabilitaPrijmuScore);
                console.log('Celkový prescoring:', prescoring.toFixed(1) + ' bodů');
                
                // Omezení výsledku na rozsah 0-100
                return Math.max(0, Math.min(100, prescoring));
            }
            
            // Aktualizace výpočtů
            function updateCalculations() {
                console.log('Načítám hodnoty z formuláře...');
                
                // Načítáme vstupy z formuláře a odstraňujeme mezery
                const monthlyIncome = parseFloat(document.getElementById('monthly-income').value.replace(/\s/g, '')) || 0;
                const monthlyExpenses = parseFloat(document.getElementById('monthly-expenses').value.replace(/\s/g, '')) || 0;
                const monthlyDebts = parseFloat(document.getElementById('monthly-debts').value.replace(/\s/g, '')) || 0;
                const dependents = parseInt(document.getElementById('dependents').value);
                const propertyValue = parseFloat(document.getElementById('property-value').value.replace(/\s/g, '')) || 0;
                const years = parseInt(document.getElementById('mortgage-years').value);
                
                console.log('Načtené hodnoty:');
                console.log('- Měsíční příjem:', monthlyIncome);
                console.log('- Měsíční výdaje:', monthlyExpenses);
                console.log('- Měsíční závazky:', monthlyDebts);
                console.log('- Počet vyživovaných osob:', dependents);
                console.log('- Hodnota nemovitosti:', propertyValue);
                console.log('- Doba splácení (roky):', years);
                
                // Výpočet maximální hypotéky – zohledníme běžné výdaje a použijeme měkčí limit na disponibilní příjem
                const maxMortgageRaw = calculateMaxMortgage(monthlyIncome, monthlyExpenses, monthlyDebts, dependents);
                console.log('Vypočtená max. hypotéka (bez LTV stropu):', maxMortgageRaw);

                // Uplatnění LTV stropu při známé hodnotě nemovitosti
                const maxLTV = 80; // Maximální povolené LTV je 80%
                const ltvCapAmount = propertyValue > 0 ? propertyValue * (maxLTV/100) : Infinity;
                const maxMortgage = propertyValue > 0 ? Math.min(maxMortgageRaw, ltvCapAmount) : maxMortgageRaw;
                // Výpočet LTV a vlastních zdrojů dle efektivní (zastropované) hypotéky
                const ltv = propertyValue > 0 ? (maxMortgage / propertyValue) * 100 : 0;
                const ownResources = propertyValue > 0 ? Math.max(propertyValue * (1 - maxLTV/100), propertyValue - maxMortgage) : 0;

                // Výpočet měsíční splátky z efektivní (zastropované) hypotéky
                const monthlyPayment = calculateMonthlyPayment(maxMortgage, years, DEFAULT_INTEREST_RATE);
                
                // Výpočet DSTI
                const dsti = monthlyIncome > 0 ? (monthlyPayment / monthlyIncome) * 100 : 0;

                // Výpočet DTI - skutečný poměr úvěru k ročnímu příjmu (z efektivní hypotéky)
                const dti = monthlyIncome > 0 ? maxMortgage / (monthlyIncome * 12) : 0;
                
                // Výpočet Prescoringu - defaultní hodnoty pro kreditní historii a stabilitu příjmu
                // Pro reálné nasazení by tyto hodnoty měly být získány z formuláře
                const kreditniHistorie = 0.8; // Předpokládáme dobrou kreditní historii (80%)
                const stabilitaPrijmu = 0.9; // Předpokládáme stabilní příjem (90%)
                
                // Výpočet celkového prescoringu
                const prescoringValue = calculatePrescoring(ltv, dti, dsti / 100, kreditniHistorie, stabilitaPrijmu);

                // Aktualizace UI - odstraněna duplicita
                document.getElementById('max-mortgage').textContent = formatCurrency(maxMortgage);
                document.getElementById('monthly-payment').textContent = formatCurrency(monthlyPayment);
                document.getElementById('ltv').textContent = formatPercent(ltv);
                document.getElementById('dsti').textContent = formatPercent(dsti);
                document.getElementById('dti').textContent = dti.toFixed(2);
                document.getElementById('own-resources').textContent = formatCurrency(ownResources);
                
                // Aktualizace Prescoringu v UI - je potřeba přidat element na stránku
                if (document.getElementById('prescoring-value')) {
                    document.getElementById('prescoring-value').textContent = prescoringValue.toFixed(1);
                    
                    // Přidání barevného označení podle výsledku
                    const prescoringElement = document.getElementById('prescoring-value');
                    if (prescoringValue >= 80) {
                        prescoringElement.className = 'text-green-600 font-bold';
                    } else if (prescoringValue >= 60) {
                        prescoringElement.className = 'text-yellow-600 font-bold';
                    } else {
                        prescoringElement.className = 'text-red-600 font-bold';
                    }
                } else {
                    console.log('Prescoring:', prescoringValue.toFixed(1) + ' bodů');
                }
            }
    
            // Formátování vstupu
            function formatInput(input) {
                let value = input.value.replace(/\s/g, '').replace(/[^\d]/g, '');
                if (value) {
                    input.value = new Intl.NumberFormat('cs-CZ').format(parseInt(value));
                }
            }
    
            // Generování reportu
            function generateReport() {
                const monthlyIncome = parseFloat(document.getElementById('monthly-income').value.replace(/\s/g, '')) || 0;
                const monthlyExpenses = parseFloat(document.getElementById('monthly-expenses').value.replace(/\s/g, '')) || 0;
                const monthlyDebts = parseFloat(document.getElementById('monthly-debts').value.replace(/\s/g, '')) || 0;
                const dependents = parseInt(document.getElementById('dependents').value);
                const propertyValue = parseFloat(document.getElementById('property-value').value.replace(/\s/g, '')) || 0;
                const years = parseInt(document.getElementById('mortgage-years').value);

                // Max hypotéka – zohledníme běžné výdaje a použijeme měkčí limit na disponibilní příjem
                const maxMortgageRaw = calculateMaxMortgage(monthlyIncome, monthlyExpenses, monthlyDebts, dependents);
                const maxLTV = 80; // maximální LTV používané v reportu
                const ltvCapAmount = propertyValue > 0 ? propertyValue * (maxLTV/100) : Infinity;
                const maxMortgage = propertyValue > 0 ? Math.min(maxMortgageRaw, ltvCapAmount) : maxMortgageRaw;
                const monthlyPayment = calculateMonthlyPayment(maxMortgage, years, DEFAULT_INTEREST_RATE);
                const ltv = propertyValue > 0 ? (maxMortgage / propertyValue) * 100 : 0;
                const dsti = monthlyIncome > 0 ? (monthlyPayment / monthlyIncome) * 100 : 0;
                const ownResources = propertyValue > 0 ? Math.max(propertyValue * (1 - maxLTV/100), propertyValue - maxMortgage) : 0;

                return `
Podrobný report z Hypoteeka.cz prescoring kalkulačky

Vaše údaje:
- Čistý měsíční příjem: ${formatCurrency(monthlyIncome)}
- Měsíční výdaje: ${formatCurrency(monthlyExpenses)}
- Stávající závazky: ${formatCurrency(monthlyDebts)}
- Počet vyživovaných osob: ${dependents}
- Hodnota nemovitosti: ${formatCurrency(propertyValue)}
- Délka hypotéky: ${years} let

Výsledky prescoringu:
- Maximální výše hypotéky: ${formatCurrency(maxMortgage)}
- Měsíční splátka: ${formatCurrency(monthlyPayment)}
- LTV (Loan to Value): ${formatPercent(ltv)}
  Tento ukazatel říká, jaké procento z hodnoty nemovitosti tvoří hypotéka. Banky aktuálně poskytují hypotéky do 80 % LTV.

- DSTI (Debt Service to Income): ${formatPercent(dsti)}
  Tento ukazatel říká, jakou část vašeho měsíčního příjmu tvoří splátka hypotéky. Čím nižší, tím lépe.

- Nutné vlastní zdroje: ${formatCurrency(ownResources)}
  Toto je částka, kterou musíte mít našetřenou z vlastních zdrojů.

Další kroky:
1. Kontaktujte nás pro konzultaci vaší situace
2. Připravte si potřebné dokumenty (výpisy z účtu, potvrzení o příjmu)
3. Společně vybereme nejvýhodnější hypotéku

Máte-li jakékoliv dotazy, neváhejte nás kontaktovat.
Tým Hypoteeka.cz
`;
            }

            // Funkce pro odeslání reportu
            function sendReport() {
                const email = document.getElementById('email').value;
                if (!email) {
                    alert('Prosím zadejte svůj email.');
                    return;
                }
                if (!email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
                    alert('Prosím zadejte platný email.');
                    return;
                }

                const report = generateReport();
                
                // Zobrazíme loading stav
                const button = document.querySelector('button[onclick="sendReport()"]');
                const originalText = button.textContent;
                button.textContent = 'Odesílám...';
                button.disabled = true;

                // Použijeme EmailJS pro odeslání emailu
                emailjs.send(
                    "VÁŠ_SERVICE_ID", // ID vaší EmailJS service
                    "VAŠE_TEMPLATE_ID", // ID vaší EmailJS šablony
                    {
                        to_email: email,
                        report_content: report
                    }
                ).then(
                    function(response) {
                        alert('Report byl úspěšně odeslán na váš email!');
                        button.textContent = originalText;
                        button.disabled = false;
                    },
                    function(error) {
                        alert('Omlouváme se, při odesílání reportu došlo k chybě. Zkuste to prosím později.');
                        console.error('Email error:', error);
                        button.textContent = originalText;
                        button.disabled = false;
                    }
                );
            }

            // Inicializace
            document.addEventListener('DOMContentLoaded', function() {
                const inputs = ['monthly-income', 'monthly-expenses', 'monthly-debts', 'property-value'];
                inputs.forEach(id => {
                    const input = document.getElementById(id);
                    input.addEventListener('input', function() {
                        formatInput(this);
                        updateCalculations();
                    });
                    formatInput(input); // Formátujeme vstupní hodnoty při načtení
                });

                // Reakce i na změny selectů (aby se přepočetl LTV/DSTI při změně doby či vyživovaných osob)
                const selects = ['dependents', 'mortgage-years'];
                selects.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.addEventListener('change', updateCalculations);
                });
                
                // Přidání event listenerů
                document.getElementById('dependents').addEventListener('change', updateCalculations);
                document.getElementById('mortgage-years').addEventListener('change', updateCalculations);
                // Ochrana před chybami: tlačítka s ID zde nejsou, odeslání řeší inline onclick
                const genBtn = document.getElementById('generate-report');
                if (genBtn) genBtn.addEventListener('click', generateReport);
                const sendBtn = document.getElementById('send-report');
                if (sendBtn) sendBtn.addEventListener('click', sendReport);
                
                // Spustíme výpočet okamžitě po načtení stránky s malým zpožděním
                console.log('Inicializace dokončena, spoustím výpočet...');
                setTimeout(updateCalculations, 100);
            });
        </script>
        
    </div> <!-- Uzavření div x-data container -->
    
    <!-- Notifikace -->
    <div id="notifications" class="fixed bottom-8 left-8 z-50 flex flex-col gap-4">
        <!-- Notifikace budou přidávány zde dynamicky -->
    </div>

    <!-- Cookie lišta -->
    <div id="cookie-banner" class="fixed bottom-0 left-0 right-0 bg-white shadow-lg transform transition-transform duration-300 ease-in-out z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="flex-1">
                    <p class="text-gray-600">
                        Používáme cookies, abychom vám poskytli co nejlepší zážitek z našich stránek. Více informací o používání cookies najdete v našich 
                        <a href="#" class="text-primary-600 hover:text-primary-700 underline">Zásadách ochrany osobních údajů</a>.
                    </p>
                </div>
                <div class="flex gap-4">
                    <button id="reject-cookies" class="btn btn-secondary">
                        Odmítnout
                    </button>
                    <button id="accept-cookies" class="btn btn-primary">
                        Přijmout vše
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer include -->
    
    
<div id="footer-container"></div>
<script src="/includes.js"></script>
</body>
</html>
